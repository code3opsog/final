{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/stashy/Desktop/Projects/Trend/src/lib/auto-filter-worker.ts"],"sourcesContent":["import cron from 'node-cron';\r\n\r\n/**\r\n * Background Auto-Filter Worker\r\n * Runs every 5 minutes to fetch friend requests and auto-decline bots\r\n * This initializes when the Next.js server starts\r\n */\r\n\r\nlet isInitialized = false;\r\n\r\nexport function initAutoFilterWorker() {\r\n    if (isInitialized) {\r\n        console.log('[Auto-Filter Worker] Already initialized, skipping...');\r\n        return;\r\n    }\r\n\r\n    console.log('[Auto-Filter Worker] Initializing background job scheduler...');\r\n\r\n    // Run every 5 minutes\r\n    cron.schedule('*/5 * * * *', async () => {\r\n        console.log(`[Auto-Filter Worker] Running at ${new Date().toISOString()}`);\r\n\r\n        try {\r\n            // Call the auto-fetch endpoint internally\r\n            const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\r\n            const cronSecret = process.env.CRON_SECRET || '';\r\n\r\n            const response = await fetch(`${baseUrl}/api/cron/auto-fetch`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${cronSecret}`\r\n                }\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (response.ok) {\r\n                console.log(`[Auto-Filter Worker] Success! Processed ${data.processed} accounts`);\r\n                if (data.results) {\r\n                    for (const result of data.results) {\r\n                        console.log(`  - ${result.accountName}: fetched ${result.fetched}, declined ${result.declined}`);\r\n                    }\r\n                }\r\n            } else {\r\n                console.error('[Auto-Filter Worker] Error:', data.error);\r\n            }\r\n        } catch (error) {\r\n            console.error('[Auto-Filter Worker] Failed to run auto-fetch:', error);\r\n        }\r\n    });\r\n\r\n    isInitialized = true;\r\n    console.log('[Auto-Filter Worker] Scheduled to run every 5 minutes');\r\n}\r\n\r\n// Export for manual trigger if needed\r\nexport async function runAutoFilterNow() {\r\n    console.log('[Auto-Filter Worker] Manual trigger...');\r\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\r\n    const cronSecret = process.env.CRON_SECRET || '';\r\n\r\n    try {\r\n        const response = await fetch(`${baseUrl}/api/cron/auto-fetch`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${cronSecret}`\r\n            }\r\n        });\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error('[Auto-Filter Worker] Manual trigger failed:', error);\r\n        throw error;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA;;;;CAIC,GAED,IAAI,gBAAgB;AAEb,SAAS;IACZ,IAAI,eAAe;QACf,QAAQ,GAAG,CAAC;QACZ;IACJ;IAEA,QAAQ,GAAG,CAAC;IAEZ,sBAAsB;IACtB,sLAAI,CAAC,QAAQ,CAAC,eAAe;QACzB,QAAQ,GAAG,CAAC,CAAC,gCAAgC,EAAE,IAAI,OAAO,WAAW,IAAI;QAEzE,IAAI;YACA,0CAA0C;YAC1C,MAAM,UAAU,QAAQ,GAAG,CAAC,oBAAoB,IAAI;YACpD,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW,IAAI;YAE9C,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,oBAAoB,CAAC,EAAE;gBAC3D,QAAQ;gBACR,SAAS;oBACL,gBAAgB;oBAChB,iBAAiB,CAAC,OAAO,EAAE,YAAY;gBAC3C;YACJ;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,IAAI,SAAS,EAAE,EAAE;gBACb,QAAQ,GAAG,CAAC,CAAC,wCAAwC,EAAE,KAAK,SAAS,CAAC,SAAS,CAAC;gBAChF,IAAI,KAAK,OAAO,EAAE;oBACd,KAAK,MAAM,UAAU,KAAK,OAAO,CAAE;wBAC/B,QAAQ,GAAG,CAAC,CAAC,IAAI,EAAE,OAAO,WAAW,CAAC,UAAU,EAAE,OAAO,OAAO,CAAC,WAAW,EAAE,OAAO,QAAQ,EAAE;oBACnG;gBACJ;YACJ,OAAO;gBACH,QAAQ,KAAK,CAAC,+BAA+B,KAAK,KAAK;YAC3D;QACJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,kDAAkD;QACpE;IACJ;IAEA,gBAAgB;IAChB,QAAQ,GAAG,CAAC;AAChB;AAGO,eAAe;IAClB,QAAQ,GAAG,CAAC;IACZ,MAAM,UAAU,QAAQ,GAAG,CAAC,oBAAoB,IAAI;IACpD,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW,IAAI;IAE9C,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,oBAAoB,CAAC,EAAE;YAC3D,QAAQ;YACR,SAAS;gBACL,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,YAAY;YAC3C;QACJ;QACA,OAAO,MAAM,SAAS,IAAI;IAC9B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,MAAM;IACV;AACJ"}}]
}